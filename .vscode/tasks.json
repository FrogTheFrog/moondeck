{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "checkforsettings",
            "type": "shell",
            "group": "none",
            "detail": "Check that settings.json has been created",
            "command": "bash -c ${workspaceFolder}/.vscode/config.sh",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "createpluginsfolder",
            "detail": "Create plugins folder in expected directory",
            "type": "shell",
            "group": "none",
            "dependsOn": [
                "checkforsettings"
            ],
            "command": "ssh deck@${config:deckip} -p ${config:deckport} ${config:deckkey} 'echo '${config:deckpass}' | sudo -S mkdir -p ${config:deckdir}/homebrew/plugins'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "removeplugindir",
            "detail": "Delete existing plugin directory",
            "type": "shell",
            "group": "none",
            "dependsOn": [
                "createpluginsfolder"
            ],
            "command": "ssh deck@${config:deckip} -p ${config:deckport} ${config:deckkey} 'echo '${config:deckpass}' | sudo -S rm -rf ${config:deckdir}/homebrew/plugins/${workspaceFolderBasename}'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "deploytmp",
            "detail": "Deploy dev plugin to tmp dir on deck",
            "type": "shell",
            "group": "none",
            "dependsOn": [
                "removeplugindir"
            ],
            "command": "rsync -azp --delete --chmod=D0755,F0755 --rsh='ssh -p ${config:deckport} ${config:deckkey}' --exclude='.git/' --exclude='.github/' --exclude='.vscode/' --exclude='node_modules/' --exclude='src/' --exclude='*.log' --exclude='.gitignore' . deck@${config:deckip}:/tmp/${workspaceFolderBasename}-tmp",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "movedeployeddir",
            "detail": "Delete existing plugin directory",
            "type": "shell",
            "group": "none",
            "dependsOn": [
                "deploytmp"
            ],
            "command": "ssh deck@${config:deckip} -p ${config:deckport} ${config:deckkey} 'echo '${config:deckpass}' | sudo -S mv /tmp/${workspaceFolderBasename}-tmp ${config:deckdir}/homebrew/plugins/${workspaceFolderBasename}'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "changepermissions",
            "detail": "Change the permissions to expected ones",
            "type": "shell",
            "group": "none",
            "dependsOn": [
                "movedeployeddir"
            ],
            "command": "ssh deck@${config:deckip} -p ${config:deckport} ${config:deckkey} 'cd ${config:deckdir}/homebrew/plugins/ && echo '${config:deckpass}' | sudo -S chown root:root . ./${workspaceFolderBasename} ./${workspaceFolderBasename}/ ./${workspaceFolderBasename}/plugin.json'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "restartloader",
            "detail": "Restart the plugin loader (to load updated python code)",
            "type": "shell",
            "group": "none",
            "dependsOn": [],
            "command": "ssh deck@${config:deckip} -p ${config:deckport} ${config:deckkey} 'echo '${config:deckpass}' | sudo -S systemctl restart plugin_loader'",
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "deployall",
            "dependsOrder": "sequence",
            "group": "none",
            "dependsOn": [
                "changepermissions",
                "restartloader"
            ],
            "problemMatcher": [],
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
    ]
}